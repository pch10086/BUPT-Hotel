# 自动化测试脚本使用说明

## 功能说明

这个测试脚本可以根据测试用例自动执行**空调操作**（开机、关机、调温、调风速等），用于系统验收测试。

**重要：此脚本只负责执行测试用例中的空调操作，不包含办理入住和结账功能！**

## 使用方法

### 1. 安装依赖

```bash
pip install requests
```

### 2. 配置服务器地址

编辑 `tests/test_script.py`，修改 `API_BASE_URL`：

```python
API_BASE_URL = "http://localhost:8080/api"  # 本地测试
# 或
API_BASE_URL = "http://192.168.1.100:8080/api"  # 远程服务器
```

### 3. 修改测试用例

在 `tests/test_script.py` 的 `load_test_case_from_text()` 函数中，根据你的测试用例表格修改数据。

格式说明：

- 每行代表一个时间点
- **列 0**：时间点（逻辑时间，单位：分钟）
  - 每个逻辑分钟 = 10 秒真实时间
  - 例如：时间点 0 立即执行，时间点 1 在 10 秒后执行，时间点 2 在 20 秒后执行
- **列 1-5**：分别对应房间 1-5 的操作（实际房间号：101, 102, 103, 104, 105）

操作类型：

- `"开机"` - 开机操作
- `"关机"` - 关机操作
- `"18"` - 设置目标温度为 18℃
- `"高"` / `"中"` / `"低"` - 设置风速
- `"18, 高"` - 同时设置温度 18℃ 和风速高

### 4. 运行测试

```bash
cd tests
python test_script.py
```

或者从项目根目录运行：

```bash
python tests/test_script.py
```

## 验收测试流程

**重要：测试脚本只负责执行测试用例中的空调操作，不包含办理入住和结账功能！**

### 完整验收流程：

1. **启动服务**：启动后端服务
2. **办理入住**（手动操作）：
   - 登录前台账号（clerk/123456）
   - 为 5 个房间（101-105）办理入住
3. **执行测试脚本**：
   - 运行 `python tests/test_script.py`
   - 脚本会按照测试用例自动执行空调操作
4. **监控状态**（同时进行）：
   - 登录经理账号（manager/admin123）
   - 监控 5 个房间的空调状态信息
5. **结账**（测试完成后，手动操作）：
   - 切换到前台账号
   - 为每个房间执行结账操作
   - 打印账单详单

### 测试脚本执行流程：

1. **解析测试用例**：解析测试用例表格，提取所有操作和时间点
2. **按时间顺序执行**：按照时间点顺序执行操作
   - 时间点之间的等待时间 = (时间点差) × 10 秒
   - 例如：时间点 0 立即执行，时间点 1 等待 10 秒后执行，时间点 2 再等待 10 秒后执行

## 输出说明

脚本会输出：

- 每个操作的执行结果（成功/失败）
- 非法请求的验证结果（如果请求被正确拒绝，会显示"预期失败，实际失败"）
- 最终统计（总操作数、成功数、失败数）

## 注意事项

1. **确保后端服务已启动**：脚本需要连接到后端 API
2. **确保房间已办理入住**：**必须在运行脚本前手动办理 5 个房间（101-105）的入住**，否则操作会失败
3. **时间配置**：
   - 时间点使用逻辑时间（分钟）
   - 每个逻辑分钟 = 10 秒真实时间
   - 可以通过修改 `LOGIC_MINUTE_TO_REAL_SECOND` 变量调整时间比例（默认 10 秒）
4. **非法请求验证**：如果测试用例中包含非法温度请求（超出范围），需要在 `parse_operation()` 中标记 `expected_error=True`

## 扩展功能

### 支持非法请求验证

如果测试用例中包含非法温度请求，可以在解析时标记：

```python
# 例如：制冷模式设置30℃（超出18-28范围）
if temp > 28 or temp < 18:
    op.expected_error = True
```

脚本会自动验证这些请求是否被正确拒绝。

### 支持制热模式测试

修改 `parse_operation()` 中的 `mode` 参数，或者在测试用例中指定模式。

### 导出测试报告

可以在脚本末尾添加代码，将测试结果导出为 CSV 或 JSON 文件。
